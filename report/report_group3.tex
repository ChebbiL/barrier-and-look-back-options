
\documentclass[12pt,a4paper,fleqn]{article}
%\usepackage[russian]{babel}
\usepackage{multirow}
\usepackage[table,xcdraw]{xcolor}
\usepackage{amssymb,latexsym, amsmath}
\usepackage{amscd}
\usepackage{xcolor}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{mathdots}
\usepackage{amsmath,amsfonts,latexsym}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{listings}
\usepackage{color}
\usepackage[text={15cm,24cm},top=3cm]{geometry}  % This line determines the page layout.
% Consult the documentation of the geometry package if you want to change it.

% include these lines if you want to typeset your report in a sans serif font
%\renewcommand{\sfdefault}{cmbr}
%\renewcommand{\ttdefault}{cmtl}
%\renewcommand{\familydefault}{\sfdefault}

\newtheorem{remark}{Remark}
\newtheorem{Cor}{Corollary}
\newtheorem{definition}{Definition}
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{property}{Property}
\newtheorem{lemma}{Lemma}
\newtheorem{question}{Question}
\newtheorem{example}{Example}
\newcommand\tr{\mathrm{tr}}
\newcommand\Tr{\mathrm{Tr}}
\newcommand\St{\mathrm{St}}
\newcommand\ad{\mathrm{ad}}
\newcommand\Ad{\mathrm{Ad}}
\newcommand\goth{\mathfrak}
\newcommand\R{\mathbb R}
\newcommand\Z{\mathbb Z}
\newcommand\ind{\mathrm{ind}\,}
\newcommand\cork{\mathrm{corank }\,}
\newcommand\Ker{\mathrm{Ker}\, }
\newcommand\Ann{\mathrm{Ann}\, }
\newcommand\ann{\mathrm{ann}\, }
\newcommand\spann{\mathrm{span} }
\newcommand\rank{\mathrm{rank}\, }
\newcommand\corank{\mathrm{corank}\, }
\newcommand\codim{\mathrm{codim}\, }
\newcommand\Sing{{\mathsf{Sing}}}
%\newcommand\Inv{\mathsf{Inv}_{\mathrm{formal}}(a)}
\newcommand\Inv{Y_{\mathrm{formal}}(\goth g, a)}
\newcommand\kfield{{\mathbb{K}}}
%\newcommand\deg{\mathrm{deg}\, }
\newcommand\trdeg{\mathrm{tr.deg.}\,}
\newcommand\rk{\mathrm{rk}\, }
\newcommand\grad{\mathrm{grad}\, }

\newcommand{\svert}{{s_{\mathrm{vert}}}}

\newcommand{\shor}{{s_{\mathrm{hor}}}}

\newcommand{\sjord}{{s_{\mathrm{Jord}}}}

\newcommand{\Lvert}{L_{\mathrm{vert}}}

\newcommand{\Lhor}{L_{\mathrm{hor}}}

\newcommand{\dimO}{\dim \mathcal O_{\mathrm{reg}}}

\newcommand{\codimO}{\codim \mathcal O_{\mathrm{reg}}}

\newcommand{\dimSt}{\dim \mathrm{St}_{\mathrm{reg}}}

\pagestyle{headings}

\author{Course: Simulation Methods for Finance\\Professor Harry Zheng
\\[3cm] Author:\\ Tresnia Berah\\ Thomas Espel\\ Konstantin Kulak\\ Zhengtian Qiu\\Vera Zhang }
\title{Simulation Methos for Barrier/ Look-back Options }
\date{02.22.2018}
\begin{document}
\maketitle







\newpage




\newpage

\section{Generate Random Number}

There are two methods we used to generate random numbers. 
The first one is to generate a uniform distribution and then transform it into Standard Normal Distribution. The second method we tried is the system build-in function\textbf{\textit{ Randon}}, which can directly generate a variable follows Standard Normal Distribution. 

To generate a uniform distribution we tried two ways: one can use the system build-in methods \textbf{\textit{rand}}. The function will return a number between 1 and $2^{15} -1$ randomly. The range is around 30,000, way below 100,000, the sample size we plan to generate. In other words, when we use \textbf{\textit{rand}} to simulate 100,000 entries, there will be numbers appear more than once, which will create bias. We prefer the second way to generate a uniform distriubtion: linear congruential generator.

$$n_i = (an_{i-1}) \ mod\ m$$for $i=1,2,...,10,000$, and we let $ a = 7^5$, and $m = 2^{31}-1$, which gives about 2 billion points. We run 100,000 times and will only use $0.005\%$ of all points. Theoretically, no pattern should appear. 

To transform the uniform distribution we got into Standard Normal Distribution, we have tried three methods. By Central Limit theory, 

$$ Z_n = \frac{\sum_{i=1}^{n}X_i-n\mu}{\sqrt{n}\sigma}$$where $X_i$ is from the uniform distribution we generated previously. $Z_n$ converges in distribution to SND, however, it requires n, the number of uniform distribution, to be sufficiently large. Therefore this method requires significant large simulations and speed is slow consequently. 

We also tried Box-Muller methods 

$$Z_1 = \sqrt{-2lnX_1}sin(2\pi X_2),\  \Z_2=\sqrt{-2lnX_1}cos(2\pi X_2)$$Since its simulation involves computation of \textit{sine} and \textit{cosine}, the speed is slow. 
We prefer the last method, Marsaglia Polar method. 

$$ let \ V_1 = 2U_1-1,\  V_1 = 2U_2-1.$$
where $U_1$ and $U_2$ are two independent uniform distribution.
 Let\ $W = V_1^2+V_2^2.$\ If $W>1$, return to the beginning. Otherwise,

$$N_1 = \sqrt{\frac{(-2logW)}{W}}V_1,\ N_2 = \sqrt{\frac{(-2logW)}{W}}V_2$$As the computation doesnâ€™t involve sine and cosine, it is generally faster than Box-Muller.

The following is the simulation result of Standard Normal distribution and time used by different methods.
\begin{center}
\begin{tabular}{| c| c| c| c| }
\hline
\textbf{ Method} &\textbf{ Mean} & \textbf{Variance}&\textbf{ Time} \\ \hline
\textbf{\textit{ rand} generated U + CLT} & cell5 & cell6&.. \\  \hline
\textbf{\textit{ rand} generated U + Box-Muller} & cell8 & cell9&..\\ \hline
\textbf{\textit{ rand} generated U + Marsagilia Polar} & cell8 & cell9&..\\ \hline
\textbf{ linear congruential generator + CLT} & cell8 & cell9&..\\ \hline
\textbf{linear congruential generator + Box-Muller} & cell8 & cell9&..\\ \hline
\textbf{ linear congruential generator + Marsagilia} & cell8 & cell9&..\\ \hline
\textbf{\textit{Randon} }& cell8 & cell9&..\\ \hline

\end{tabular}
\end{center}

Error Analysis...
For the tasks in this project, we use the combination of linear congruential generator and Marsagilia methods to simulate random variable.

\section{Basic Task}


The asset price in a risk neutral probability space $(\Omega, \mathcal{F}, (\mathcal{F}_t)_{0\leq t\leq T}, P)$ follows Geometric Brownian Motion,

$$dS_t=rS_tdt+\sigma S_tdW_t, \ 0\leq t \leq T$$
with initial price $S_0 = S$, where $r$ is riskless interest rate, $\sigma$ volatility, and $W_t$ the standard Brownian motion. A European call option price at time $t$ with maturity time $T$ is given by
$$C_t = E[e^{-r(T-t)}(S_T-K)^+|\textit{F}_t]$$

For the basic task, we let $S_0 = 100$, $K=100$, interest rate $r = 0.05$, volatility $\sigma = 0.4$, maturity time $T =1$. We use Monte Carlo method to simulate the path of 

$$S_T=S_0e^{(r-\frac{1}{2}\sigma ^2)T+\sigma \sqrt{T}Z} $$

and get sample distribution of $(S_t-K)^+$. By Black-Scholes formula, 

\begin{center}
\begin{equation}
C_bs(S_t, K) = N(d_1)S_t - N(d_2)Ke^{-r(T-t)} 
\end{equation}
\end{center}
where $$d_1=\frac{1}{\sigma \sqrt{T-t}}[ln(\frac{S_t}{K})+(r+\frac{\sigma^2}{2})(T-t)],\ d_2 = d_1-\sigma \sqrt{T-t}$$
The closed-form Greeks are calculated the following way:

$$Delta = \frac{\partial C}{\partial S}=N(d_1)$$
$$Gamma = \frac{\partial^2 C}{\partial S^2}=\frac{N'(d_1)}{S\sigma \sqrt{T-t}}$$
$$Vega =  \frac{\partial C}{\partial \sigma}=N'(d_1)\sqrt{T-t}$$

To calculate the Greeks from simulation, we used Likelihood ratio method.As the Call option price is given by

$$C = e^{-rT}E[(S_T-K)^+]=e^{-rT}\int(S_T-K)^+ h_{S_0}(S_T) dS_T$$

where $ h_{S_0}(S_T)$ is the probability density function of $(S_T-K)^+$. Then by Likelihood ratio methods, the partial dirivative of C with respect to $S_0$ is 

$$\frac{\partial C}{\partial S_0}=\int(S_T-K)^+\frac{d}{dS_0}h_{S_0}(S_T) dS_T=E[(S_T-K)^+\frac{h'_{S_0}(S_T)}{h_{S_0}(S_T)}] $$

And the lognormal density function of $S_T$ is given by
$$h(x)=\frac{1}{x\sigma \sqrt{T}}\phi(\xi(x)), \ \ \xi(x)=\frac{ln(x/S_0)-(r-\frac{1}{2}\sigma^2)T}{\sigma \sqrt{T}}  $$

Therefore, 

$$Delta=\frac{\partial C}{\partial S_0}=E[e^{-rT}(S_T-K)^+\frac{Z}{S_0\sigma\sqrt{T}}]$$
where $Z~N(0,1).$

$$Gamma = \frac{\partial^2 C}{\partial  S_0^2 }=E[e^{-rT}(S_T-K)^+(\frac{Z^2-1}{S_0^2\sigma^2 T } - \frac{Z}{S_0^2 \sigma \sqrt{T}})]$$

The following are the results calculated from the closed-form formulae and the simulations:

\begin{center}
\begin{tabular}{| c| c| c |c| c| }
\hline
\multirow{2}{*}{} & \multicolumn{1}{c|}{\multirow{2}{*}{\textbf{Black-Scholes}}} & \multicolumn{3}{l|}{\textbf{Monte Carlo Simulation}} \\ \cline{3-5} 
                  & \multicolumn{1}{c|}{}                                        & \textbf{1,000}  & \textbf{10,000} & \textbf{100,000} \\ \hline
\textbf{Option Price} &                  ....                                 &                 &                 &                  \\ \hline
\textbf{Delta}    &                  ....                                 &                 &                 &                  \\ \hline
\textbf{Gamma}    &                 ....                                       &                 &                 &                  \\ \hline
\textbf{Vega}    &                  .....                                    &                 &                 &                  \\ \hline

\end{tabular}
\end{center}


The following is the Statistical information of errors as number of simulations increases

\begin{table}[]
\centering
\label{my-label}
\begin{tabular}{|c|c|c|c|c|c|}
\hline
\textbf{}                                                                        & \textbf{Simulation Number} & \textbf{Mean}         & \textbf{Error}        & \textbf{Variance}     & \textbf{Time}         \\ \hline
\multirow{3}{*}{\textbf{\begin{tabular}[c]{@{}c@{}}Option\\ Price\end{tabular}}} & 1,000                      &                       &                       &                       &                       \\ \cline{2-6} 
                                                                                 & 10,000                     &                       &                       &                       &                       \\ \cline{2-6} 
                                                                                 & 100,000                    &                       &                       &                       &                       \\ \hline
\multirow{3}{*}{\textbf{Delta}}                                                  & 1,000                      & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} \\ \cline{2-6} 
                                                                                 & 10,000                     & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} \\ \cline{2-6} 
                                                                                 & 100,000                    &                       &                       &                       &                       \\ \hline
\multirow{3}{*}{\textbf{Gamma}}                                                  & 1,000                      & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} \\ \cline{2-6} 
                                                                                 & 10,000                     & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} \\ \cline{2-6} 
                                                                                 & 100,000                    &                       &                       &                       &                       \\ \hline
\multirow{3}{*}{\textbf{Vega}}                                                   & 1,000                      & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} \\ \cline{2-6} 
                                                                                 & 10,000                     & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} & \multicolumn{1}{l|}{} \\ \cline{2-6} 
                                                                                 & 100,000                    &                       &                       &                       &                       \\ \hline
\end{tabular}
\end{table}



\section{Main Task - Barrier Option}

For an up-and-out barrier call option $A_T=(S_T-K)^+1_{max 0\leq t\leq T S_t\leq B}$, where $B$ is a barrier leve and $1_S$ is an indicator function. The closed form formula for the option price is
\begin{equation}
\begin{aligned}
UOC(S,K,B) ={} &1_{B>K}\{ C_{bs}(S, K)-C_{bs}(S,B)-(B-K)e^{-rT}N[d_{1}(S,B)] \\
      & -\frac{B}{S}^{\frac{2v^2}{\sigma^2}}[C_{bs}(\frac{B^2}{S}, K)-C_{bs}\frac{B^2}{S}, B) \\
      & -(B-K)e^{-rT}N[d_{1}(S,B)]]\}
\end{aligned}
\end{equation}
Where $C_{bs}$ and $d_{1}$ are as stated in the Black-Scholes formula (1), and $v=r-\frac{\sigma^2}{2}$. 
\\
\\
Closed-form for greeks...
\\
\\
We stimulate the path of $S_t$ by taking the maturity time $T$ into 10,000 steps, and we simulate 5,000 such paths. As standard normal distribution is symmetrically distributed, 5,000 paths can be treated as 10,000 paths by adding negative sign and creating the other 5,000.

To determine the greeks for Barrier Option, we need to compute the partial differential equation of 


\begin{table}[]
\centering
\label{my-label}
\begin{tabular}{|c|l|c|c|c|c|}
\hline
                      & \multicolumn{1}{c|}{\textbf{\begin{tabular}[c]{@{}c@{}}Closed-form\\ Formula\end{tabular}}} & \textbf{Mean} & \textbf{Error} & \textbf{Variance} & \textbf{Time} \\ \hline
\textbf{Option Price} &                                                                                             &               &                &                   &               \\ \hline
\textbf{Delta}        &                                                                                             &               &                &                   &               \\ \hline
\textbf{Gamma}        &                                                                                             &               &                &                   &               \\ \hline
\textbf{Vega}         &                                                                                             &               &                &                   &               \\ \hline
\end{tabular}
\end{table}


To analyze further the accuracy of our simulation, we plot the simulated option prices and greaks versus their theoretical value as barrier increase. 

graph
graph
graph


\newpage

\newpage
%\appendix





\begin{thebibliography}{9}

\bibitem{Reference1} 
A

\bibitem{Reference2}
B
 



\end{thebibliography}
\newpage


\appendix
\section{Appendix: R code of part A}
% the \\ insures the section title is centered below the phrase: AppendixA


\lstset{ %
  language=R,                     % the language of the code
  basicstyle=\footnotesize,       % the size of the fonts that are used for the code
  numbers=left,                   % where to put the line-numbers
  numberstyle=\tiny\color{gray},  % the style that is used for the line-numbers
  stepnumber=1,                   % the step between two line-numbers. If it's 1, each line
                                  % will be numbered
  numbersep=5pt,                  % how far the line-numbers are from the code
  backgroundcolor=\color{white},  % choose the background color. You must add \usepackage{color}
  showspaces=false,               % show spaces adding particular underscores
  showstringspaces=false,         % underline spaces within strings
  showtabs=false,                 % show tabs within strings adding particular underscores
  frame=single,                   % adds a frame around the code
  rulecolor=\color{black},        % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. commens (green here))
  tabsize=2,                      % sets default tabsize to 2 spaces
  captionpos=b,                   % sets the caption-position to bottom
  breaklines=true,                % sets automatic line breaking
  breakatwhitespace=false,        % sets if automatic breaks should only happen at whitespace
  title=\lstname,                 % show the filename of files included with \lstinputlisting;
                                  % also try caption instead of title
  keywordstyle=\color{blue},      % keyword style
  commentstyle=\color{dkgreen},   % comment style
  stringstyle=\color{mauve},      % string literal style
  escapeinside={\%*}{*)},         % if you want to add a comment within your code
  morekeywords={*,...}            % if you want to add more keywords to the set
} 
% \lstinputlisting{partA.R}
% \lstinputlisting{partB.R}

\newpage


\end{document}
